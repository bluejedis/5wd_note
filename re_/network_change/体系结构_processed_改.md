

# 第1章计算机网络体系结构  

<ul>

## 【考纲内容】  

<ul>

（一）计算机网络概述计算机网络的概念、组成与功能；计算机网络的分类：计算机网络的性能指标二）计算机网络体系结构与参考模型计算机网络分层结构：计算机网络协议、接口、服务的概念：ISO/OSI TCP/IP模型  

</ul>

## 【复习提示】  

<ul>

- 本章主要介绍计算机网络体系结构的基本概念
  - 读者可以在理解的基础上适当地记忆

- 重点掌握
  - 网络的分层结构（包括5层和7层结构）
  - 尤其是ISO/OSI参考模型各层的功能
  - 以及相关协议、接口和服务等概念

- 熟悉
  - 有关网络的各种性能指标
  - 尤其是时延、带宽、速率等的计算

</ul>

</ul>

# 计算机网络概述  

<ul>

## 概念  

<ul>

- 计算机网络
  - 是一个将众多分散的、自治的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。

- 计算机网络（简称网络）
  - 由若干结点（node，或译为节点）和连接这些结点的链路（link）组成。
  - 网络中的结点可以是计算机、集线器、交换机或路由器等。
  - 网络之间还可通过路由器互连构成一个覆盖范围更广的计算机网络，这样的网络称为互连网（internet）。

thus，it can be understood this way：网络把许多计算机连在一起，而互连网则把许多网络通过路由器连在一起。

### internet与Internet的区别

<ul>

- internet（互连网）
  - 是一个通用名词
  - 泛指由多个计算机网络互连而成的计算机网络
  - 在这些网络之间可以使用任意的通信协议作为通信规则
  - 不一定非要使用TCP/IP协议

- Internet（互联网或因特网）
  - 则是一个专用名词
  - 指当前全球最大的、开放的、由众多网络和路由器互连而成的特定计算机网络
  - 它采用TCP/IP协议族作为通信规则

</ul>

</ul>

## 组成  

<ul>

### 组成部分视角

<ul>

- 硬件
  - 主机（也称端系统）
  - 通信链路（如双绞线、光纤）
  - 交换设备（如路由器、交换机等）
  - 通信处理机（如网卡）
- 软件
  - 各种实现资源共享的软件
  - 方便用户使用的各利工具软件（如E-mail程序、FTP程序、聊天程序等）
- 协议
  - 是计算机网络的核心
  - 如同交通规则制约汽车驾驶一样，协议规定了网络传输数据时所遵循的规范

</ul>

### 工作方式视角

<ul>

- 边缘部分
  - 由所有连接到互联网上的供用户直接使用的主机组成
  - 用来进行通信（如传输数据、音频或视频）和资源共享
- 核心部分
  - 由大量网络和连接这些网络的路由器组成
  - 为边缘部分提供连通性和交换服务

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/287998ad20487ffe1402b983737c30bf30a87d0899b167101b7b13670e260760.jpg)  
图1.1互联网的核心部分与边缘部分  

</ul>

### 功能组成视角

<ul>

- 通信子网
  - 由各种传输介质、通信设备和相应的网络协议组成
  - 使网络具有数据传输、交换、控制和存储的能力
  - 实现联网计算机之间的数据通信
- 资源子网
  - 是实现资源共享功能的设备及其软件的集合
  - 向网络用户提供共享其他计算机上的硬件资源、软件资源和数据资源的服务

</ul>

</ul>

## 功能  

<ul>

### 数据通信  

<ul>

- 是计算机网络最基本和最重要的功能
- 用来实现联网计算机之间各种信息的传输
- 并联系分散在不同地理位置的计算机，进行统一的调配、控制和管理
- 例如，文件传输、电子邮件等应用，离开了计算机网络就无法实现

</ul>

### 资源共享  

<ul>

- 既可是软件共享、数据共享，又可是硬件共享
- 使计算机网络中的资源互通有无、分工协作
- 从而极大地提高了硬件资源、软件资源和数据资源的利用率

</ul>

### 分布式处理  

<ul>

- 当计算机网络中的某个计算机系统负荷过重时，可将其处理的某个复杂任务分配给网络中的其他计算机系统
- 从而利用空闲计算机资源来提高整个系统的利用率

</ul>

### 提高可靠性  

<ul>

- 计算机网络中的各台计算机可以通过网络互为替代机

</ul>

### 负载均衡  

<ul>

- 将工作任务均衡地分配给计算机网络中的各台计算机

</ul>

### 其他功能

<ul>

- 还可实现电子化办公与服务、远程教育、娱乐等功能
- 满足了社会的需求，方便了人们的学习、工作和生活
- 具有巨大的经济效益

</ul>

</ul>

## 电路交换、报文交换与分组交换  

<ul>

- 在网络核心部分起重要作用的是路由器（router）
  - 它对收到的分组进行存储转发来实现分组交换
- 要了解分组交换的原理
  - 首先就要学习电路交换的相关概念

### 电路交换  

<ul>

最典型的电路交换网是传统电话网，如图1.2所示。

#### 工作原理

<ul>

- 从通信资源分配的角度看
  - 交换就是按照某种方式动态地分配传输线路的资源

- 电路交换分为三步
  - 连接建立
  - 数据传输
  - 连接释放

- 在进行数据传输前
  - 两个结点之间必须先建立一条专用（双方独占）的物理通信路径
    - 由通信双方之间的交换设备和链路逐段连接而成
    - 该路径可能经过许多中间结点

- 在数据传输过程中
  - 这一物理通信路径始终被用户独占
  - 直到通信结束后才被释放

- 在电路交换的整个通信阶段
  - 比特流连续地从源点直达终点
  - 就好像在一个管道中传送

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f245e6639db9fb4e87d89db234663c1b92adb3022eb928c2b1f53e57f1c3bbcc.jpg)  
图1.2电路交换示意图  

</ul>

#### 优点

<ul>

- 通信时延小
  - 因为通信线路为通信双方专用，数据直达，所以传输时延非常小
- 有序传输
  - 双方通信时按发送顺序传送数据，不存在失序问题
- 没有冲突
  - 不同的通信双方拥有不同的信道，不会出现争用物理信道的问题
- 适用范围广
  - 电路交换既适用于传输模拟信号，又适用于传输数字信号
- 实时性强
  - 通信双方之间的物理通路一旦建立，双方就可随时通信
- 控制简单
  - 电路交换的交换设备（交换机等）及控制均较简单

</ul>

#### 缺点

<ul>

- 建立连接时间长
  - 电路交换的平均连接建立时间对计算机通信来说太长
- 线路利用率低
  - 物理通路被通信双方独占，即使线路空闲，也不能供其他用户使用
- 灵活性差
  - 物理通路中的任何一点出现故障，就必须重新拨号建立新的连接
- 难以规格化
  - 不同类型、不同规格、不同速率的终端很难相互进行通信
- 难以实现差错控制
  - 中间结点不具备存储和检验数据的能力，无法发现并纠正错误

</ul>

注意，在电路交换中，电路建立后，除源结点和目的结点外，电路上的任何结点都采取"直通方式"接收数据和发送数据，即不存在存储转发所耗费的时间。  

</ul>

### 报文交换  

<ul>

>pro：报文交换网中存储转发、数据传送时间的计算（2013）  

#### 工作原理

<ul>

- 数据交换的单位是报文
  - 用户数据加上源地址、目的地址等信息后，封装成报文（message）
- 报文交换采用存储转发技术
  - 整个报文先传送到相邻的结点
  - 全部存储后查找转发表，转发到下一个结点
  - 如此重复，直至到达目的结点
- 每个报文都可单独选择到达目的结点的路径

</ul>

#### 优点

<ul>

- 无须建立连接
  - 通信前无须建立连接，没有建立连接时延，用户可随时发送报文
- 动态分配线路
  - 交换设备存储整个报文后，选择一条合适的空闲线路，转发报文
- 线路可靠性高
  - 若某条传输路径发生故障，则可重新选择另一条路径传输数据
- 线路利用率高
  - 报文在哪段链路上传送时才占用这段链路的通信资源
- 提供多目标服务
  - 一个报文可以同时发送给多个目的地址

</ul>

#### 缺点

<ul>

- 转发时延高
  - 交换结点要将报文整体接收完后，才能查找转发表转发到下一个结点
- 缓存开销大
  - 报文的大小没有限制，这就要求交换结点拥有较大的缓存空间
- 错误处理低效
  - 报文较长时，发生错误的概率相对更大，重传整个报文的代价也很大

</ul>

</ul>

### 分组交换  

<ul>

>pro：分组交换网中存储转发、数据传送时间的计算（2010、2013、2023）  

#### 工作原理

<ul>

- 分组交换也采用存储转发技术，但解决了报文交换中报文过长的问题
  - 若报文太长，则对交换结点的缓存容量就有很大的需求，在错误处理方面也比较低效
  - 源结点在发送之前，先把较长的报文划分成若干较小的等长数据段
    - 在每个数据段前面添加一些由必要控制信息（如源地址、目的地址和编号信息等）组成的**首部**，构成分组（Packet）

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/2d299f322302399b30b0f2b21d0337245ceeccac10e0720f8635d7b7c8877980.jpg)  
图1.3构成分组的过程  

- 源结点将分组发送到分组交换网中，分组交换网中的分组交换机收到一个分组后，先将其缓存，然后从其首部中提取目的地址，据此查找自己的转发表，再后将分组转发给下一个分组交换机
- 经过多个分组交换机的存储转发后，分组最终到达目的结点

</ul>

#### 优点

<ul>

- 无建立时延
  - 通信前无须建立连接，没有建立连接时延，用户可随时发送分组
- 线路利用率高
  - 分组在哪段链路上传送时才占用这段链路的通信资源
  - 相比采用电路交换传送突发式的计算机数据，分组交换的通信线路利用率大大提高
- 简化了存储管理（相对于报文交换）
  - 因为分组的长度固定，相应缓冲区的大小也固定，在交换结点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易
- 加速传输
  - 分组是逐个传输的，可以使后一个分组的存储操作与前一个分组的转发操作并行，这种流水线方式减少了报文的传输时间
  - 此外，传输一个分组比传输一次报文所需的缓冲区小得多，这样，因缓冲区不足而等待发送的概率及时间必然也少得多
- 减小了出错概率和重发数据量
  - 因为分组较短，其出错概率必然减小，所以每次重发的数据量也就大大减少，这样不仅提高了可靠性，而且减小了传输时延

</ul>

#### 缺点

<ul>

- 存在存储转发时延
  - 尽管分组交换比报文交换的传输时延小，但相对于电路交换仍存在存储转发时延
  - 且其结点交换机必须具有更强的处理能力

- 需要传输额外的信息量
  - 每个小数据段都要加上控制信息以构成分组
  - 这使得传送的信息量增大了 $5\%\sim10\%$
  - 进而导致控制复杂，降低了通信效率，增大了处理的时延

- 当分组交换网采用数据报服务时
  - 可能出现失序、丢失或重复分组的情况
  - 分组到达目的结点时，要对分组按编号进行排序等工作
  - 这些工作很麻烦
- 若采用虚电路服务
  - 虽然没有失序问题
  - 但有呼叫建立、数据传输和虚电路释放三个过程

</ul>

</ul>

### 三种交换方式的比较

<ul>

- 当要传送的数据量很大且其传送时间远大于呼叫时间时
  - 采用电路交换较为合适
- 当端到端的通路由多段链路组成时
  - 采用分组交换传送数据较为合适
- 从提高整个网络的信道利用率看
  - 报文交换和分组交换优于电路交换
  - 其中分组交换比报文交换的时延小
    - 尤其适合计算机之间的突发式数据通信

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/cc1c6c84bafb4c42ddde56da97766fa80096e449b7643d1105d033c641008b5a.jpg)  
图1.4三种数据交换方式的比较

</ul>

</ul>

## 计算机网络的分类  

<ul>

### 按分布范围分类  

<ul>

- 广域网（WAN）
  - 任务是提供长距离通信，运送主机所发送的数据
  - 覆盖范围通常是直径为几十到几千千米的区域
  - 是互联网的核心部分
  - 连接广域网的各结点交换机的链路一般都是高速链路，具有较大的通信容量

- 城域网（MAN)
  - 覆盖范围可以跨越几个街区甚至整个城市
  - 覆盖区域的直径为 $5{\sim}50\mathrm{km}$
  - 大多采用以太网技术，因此有时也常并入局域网的范围讨论

- 局域网（LAN）
  - 一般用主机通过高速线路相连
  - 覆盖范围较小，通常是直径为几十到几千米的区域
  - 传统上，局域网使用广播技术，而广域网使用交换技术

- 个人区域网（PAN)
  - 指在个人工作的地方将消费电子设备（如平板电脑、智能手机等）用无线技术连接起来的网络
  - 也称无线个人区域网（WPAN）

</ul>

### 按传输技术分类

<ul>

- 广播式网络
  - 所有联网计算机都共享一个公共通信信道
  - 当一台计算机利用共享通信信道发送报文分组时，所有其他计算机都会"收听"到这个分组
  - 接收到该分组的计算机将通过检查目的地址来决定是否接收该分组
  - 局域网基本上都采用广播式通信技术，广域两中的元绒、上生通后两网给世木用厂猫式通后权不

- 点对点网络
  - 每条物理线路连接一对计算机
  - 若通信的两台主机之间没有直接连接的线路，则它们之间的分组传输就要通过中间结点进行存储和转发，直至目的结点

</ul>

### 按拓扑结构分类

<ul>

- 网络拓扑结构是指由网中结点（路由器、主机等）与通信线路之间的几何关系表示的网络结构，主要指通信子网的拓扑结构
- 按网络的拓扑结构，可分为总线形、星形、环形和网状网络等，如图1.5所示
- 星形、总线形和环形网络多用于局域网，网状网络多用于广域网

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/03dad756ed141050172e537aa8bcf856a949704d26cadf944b7715839d605a68.jpg)  
图1.5几种不同的网络拓扑结构

#### 总线形网络

<ul>

- 用单根传输线把计算机连接起来
- 优点
  - 建网容易
  - 增/减结点方便
  - 节省线路
- 缺点
  - 重负载时通信效率不高
  - 总线任意一处对故障敏感

</ul>

#### 星形网络

<ul>

- 每个终端或计算机都以单独的线路与中央设备相连
- 中央设备一般是交换机或路由器
- 优点
  - 便于集中控制和管理
- 缺点
  - 成本高
  - 中央设备对故障敏感

</ul>

#### 环形网络

<ul>

- 所有计算机接口设备连接成一个环
- 环形网络最典型的例子是令牌环局域网
- 环既可以是单环，又可以是双环，环中信号是单向传输的

</ul>

#### 网状网络

<ul>

- 一般情况下，每个结点至少有两条路径与其他结点相连，多用在广域网中
- 有规则型和非规则型两种
- 优点
  - 可靠性高
- 缺点
  - 控制复杂
  - 线路成本高

- 以上4种基本的网络拓扑结构可以互连为更复杂的网络

</ul>

</ul>

### 按使用者分类

<ul>

- 公用网（PublicNetwork）
  - 指电信公司出资建造的大型网络
  - "公用"的意思是指所有愿意按电信公司的规定缴纳费用的人都可使用这种网络

- 专用网（PrivateNetwork）
  - 指某个部门为满足本单位特殊业务的需要而建造的网络
  - 这种网络不向本单位外的人提供服务，如铁路、电力、军队等部门的专用网

</ul>

### 按传输介质分类

<ul>

- 传输介质可分为有线和无线两大类，因此网络可分为有线网络和无线网络
  - 有线网络又可分为双绞线网络、同轴电缆网络等
  - 无线网络又可分为蓝牙、微波、无线电等类型

</ul>

</ul>

## 计算机网络的性能指标  

<ul>

### 常用性能指标

<ul>

- 常用的性能指标如下：
  #### 速率
  - 指连接到网络上的结点在数字信道上传送数据的速率
  - 也称数据传输速率、数据传输率、数据率或比特率
  - 单位为b/s（比特/秒）或bit/s（有时也写为bps）
  - 当数据率较高时，可用 $\mathrm{{kb/s}}$  $(\mathrm{k}=10^{3}$ )、 $\mathrm{{Mb/s}}$  $(\mathbf{M}=10^{6})$ ）或Gb/s（ $\mathrm{{(G}}\mathrm{{=}}{10}^{\mathrm{{9}}}\mathrm{{)}}$ ）表示

  #### 带宽
  - 带宽原本表示通信线路允许通过的信号频率范围，单位是赫兹 $\mathrm{(Hz}$
  - 在计算机网络中，带宽表示网络的通信线路所能传送数据的能力
  - 是数字信道所能传送的"最高数据传输速率"的同义语，单位是比特/秒（b/s）

  #### 吞吐量
  - 指单位时间内通过某个网络（或信道、接口）的实际数据量
  - 吞吐量常用在对实际网络的测量中，受网络带宽的限制

  #### 时延
  - 指数据（一个报文或分组）从网络（或链路）的一端传送到另一端所需的总时间
  - 由4部分构成：发送时延、传播时延、处理时延和排队时延

>pro：分组交换网中各种时延的计算（2010、2013、2023）  

  ##### 发送时延
  - 也称传输时延
  - 结点将分组的所有比特推向链路所需的时间
  - 即从发送分组的第一个比特算起，到该分组的最后一个比特发送完毕所需的时间
  - 发送时延 $=$ 分组长度/发送速率传播时延
  - 电磁波在信道（传输介质）中传播一定的距离所花的时间
  - 即一个比特从链路的一端传播到另一端所需的时间
  - 传播时延 $=$ 信道长度/电磁波在信道上的传播速率

> attention:  

区分传输时延和传播时延。传输时延是路由器将分组推出所需的时间，是分组长度和链路传输速率的函数。传播时延是一个比特从一台路由器传播至另一台路由器所需的时间，是两台路由器之间距离的函数，而与分组长度或链路传输速率无关。  

  ##### 处理时延
  - 数据在交换结点为存储转发而进行的一些必要处理所花的时间
  - 例如，分析分组的首部、从分组中提取数据、差错检验或查找合适的路由等

  ##### 排队时延
  - 分组在进入路由器后要先在输入队列中排队等待处理
  - 路由器确定转发端口后，还要在输出队列中排队等待转发
  - 这就产生了排队时延

  ##### 总时延
  - 数据在网络中经历的总时延就是以上4部分时延之和
  - 总时延 $=$ 发送时延 $^+$ 传播时延 $^+$ 处理时延 $^+$ 排队时延

> attention:  

处理时延和排队时延通常可忽略不计（除非另有说明）。  

  #### 时延带宽积
  - 指发送端发送的第一个比特即将到达终点时，发送端已发出了多少比特
  - 又称以比特为单位的链路长度
  - 时延带宽积 $=$ 传播时延 $\times$ 信道带宽
  - 如图1.6所示，考虑一个代表链路的圆柱形管道，其长度表示链路的传播时延，横截面积表示链路带宽，则时延带宽积表示该管道可以容纳的比特数量

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e564fa3d8c71bff7066a52d237c4d5c1866dd55d3140f45a2653a5b0f92a936d.jpg)  
图1.6链路就像一条空心管道  

  #### 往返时延
  - 指从发送端发出一个短分组，到发送端收到来自接收端的确认（接收端收到数据后立即发送确认）总共经历的时延
  - 在互联网中，往返时延还包括各中间结点的处理时延、排队时延及转发数据时的发送时延

  #### 信道利用率
  - 用以指出某个信道有百分之多少的时间是有数据通过的
  - 信道利用率 $=$ 有数据通过时间/（有+无）数据通过时间 

</ul>

</ul>

</ul>

# 计算机网络体系结构与参考模型  

<ul>

## 计算机网络分层结构  

<ul>

>pro：网络体系结构的定义（2010）  

### 网络体系结构的定义

<ul>

- 计算机网络的各层及其协议的集合称为网络的体系结构（Architecture）
- 换言之，计算机网络的体系结构就是这个计算机网络及其所应完成的功能的精确定义
- 要强调的是，这些功能究竟是用何种硬件或软件完成的，是一个遵循这种体系结构的实现（Implementation）问题
- 体系结构是抽象的，而实现则是具体的，是真正在运行的计算机硬件和软件
- 计算机网络体系结构通常都具有可分层的特性，它将复杂的大系统分成若干较容易实现的层次

</ul>

### 分层基本原则

<ul>

- 每层都实现一种相对独立的功能，降低大系统的复杂度
- 各层之间的接口自然清晰，易于理解，相互交流尽可能少
- 各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术来实现
- 保持下层对上层的独立性，上层单向使用下层提供的服务
- 整个分层结构应能促进标准化工作

</ul>

### 分层结构中的基本概念

<ul>

#### 实体
- 第 $n$ 层中的活动元素通常称为第 $n$ 层实体
- 具体来说，实体指任何可发送或接收信息的硬件或软件进程，通常是某个特定的软件模块
- 不同机器上的同一层称为对等层，同一层的实体称为对等实体
- 第 $n$ 层实体实现的服务为第 $n+1$ 层所用
- 在这种情况下，第 $n$ 层称为服务提供者，第 $n+1$ 层则服务于用户

#### 数据单元
##### 协议数据单元（PDU）
- 对等层之间传送的数据单位称为该层的协议数据单元
- 第 $n$ 层的PDU记为 $n$ -PDU
- 各层的PDU都分为数据和控制信息两部分

##### 服务数据单元（SDU）
- 为完成用户所要求的功能而传送的数据
- 第 $n$ 层的SDU记为 $n$ SDU

##### 协议控制信息（PCI）
- 控制协议操作的信息
- 第 $n$ 层的PCI记为 $n$ PCI

##### PDU的通俗名称
- 物理层的PDU称为比特流
- 数据链路层的PDU称为顿
- 网络层的PDU称为分组
- 传输层的PDU称为报文段

##### 数据单元间的关系
- 从第 $n+1$ 层收到的PDU作为第 $n$ 层的SDU
- 加上第 $n$ 层的PCI，就封装成了第 $n$ 层的PDU
- 交给第 $n-1$ 层后作为SDU发送，接收方接收时做相反的处理
- 三者的关系为 $n{\mathrm{-SDU}}+n{\mathrm{-CI}}=n{\mathrm{-PDU}}\,{=}\,(n-1)$ -SDU

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b77b831057ee90ae6a2d9b9cae1dcbd0c76b5de0a6deea4a2c4d15026db44075.jpg)  
图1.7网络各层数据单元的联系  

</ul>

### 层次结构的含义

<ul>

- 第 $n$ 层的实体不仅要使用第 $n-1$ 层的服务来实现自身定义的功能，而且要向第 $n+1$ 层提供本层的服务，该服务是第 $n$ 层及其下面各层提供的服务总和
- 最低层只提供服务，是整个层次结构的基础；最高层面向用户提供服务
- 上一层只能通过相邻层间的接口使用下一层的服务，而不能调用其他层的服务
- 当两台主机通信时，对等层在逻辑上有一个直接信道，表现为能直接将信息传送到对方

</ul>

</ul>

## 计算机网络协议、接口、服务的概念  

<ul>

### 协议  

<ul>

#### 协议的定义
- 要在网络中做到有条不紊地交换数据，就必须遵循一些事先约定好的规则，其规定了所交换数据的格式及有关的同步问题
- 为了在网络中进行数据交换而建立的这些规则、标准或约定称为网络协议（NetworkProtocol）
- 是控制在对等实体之间进行通信的规则的集合，是水平的
- 不对等实体之间是没有协议的，如用TCP/IP协议栈通信的两个结点A和结点B，结点A的传输层和结点B的传输层之间存在协议，但结点A的传输层和结点B的网络层之间不存在协议

#### 协议的组成部分
协议由语法、语义和同步三部分组成  

>pro：同步的定义（2020）  

##### 语法
- 数据与控制信息的格式
- 例如，TCP报文段格式就是由TCP协议的语法定义的

##### 语义  
- 即需要发出何种控制信息、完成何种动作及做出何种应答
- 例如，在建立TCP连接的三次握手时所执行的操作就是由TCP协议的语义定义的

##### 同步
- 执行各种操作的条件、时序关系等，即事件实现顺序的详细说明
- 例如，建立TCP连接的三次握手操作的时序关系就是由TCP协议的同步定义的

</ul>

### 接口  

<ul>

- 同一结点内相邻两层的实体交换信息的逻辑接口称为服务访问点（ServiceAccessPoint，SAP）
- 每层只能为紧邻的层之间定义接口，而不能跨层定义接口
- 服务是通过SAP提供给上层使用的，第 $n$ 层的SAP就是第 $n+1$ 层可以访问第 $n$ 层服务的地方
- 例如，在本书描述的5层体系结构中：
  - 数据链路层的服务访问点为帧的"类型"字段
  - 网络层的服务访问点为IP数据报的"协议"字段
  - 传输层的服务访问点为"端口号"字段

</ul>

### 服务  

<ul>

#### 服务的定义
- 服务是指下层为紧邻的上层提供的功能调用，是垂直的
- 对等实体在协议的控制下，使得本层能为上层提供服务，但要实现本层协议，还需要使用下层提供的服务
- 当上层使用下层提供的服务时，必须与下层交换一些命令，这些命令称为服务原语

#### 服务原语的分类
OSI参考模型将原语划分为四类：  

##### 请求（Reguest）
- 由服务用户发往服务提供者，请求完成某项工作

##### 指示（Indication）
- 由服务提供者发往服务用户，指示用户做某件事情

##### 响应（Response）
- 由服务用户发往服务提供者，作为对指示的响应

##### 证实（Confirmation）
- 由服务提供者发往服务用户，作为对请求的证实

- 这四类原语用于不同的功能，如建立连接、传输数据和断开连接等
- 有应答服务包括全部四类原语，而无应答服务则只有请求和指示两类原语
- 四类原语的关系如图1.8所示

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c465c00fecdaace844348a56599b0bfb30ca06ba294b146e002eeb1081a634b4.jpg)  
图1.8四类原语的关系  

#### 协议与服务的区别
- 只有本层协议的实现才能保证向上一层提供服务
- 本层的服务用户只能看见服务而无法看见下面的协议，即下面的协议对上层的服务用户是透明的
- 协议是"水平的"，即协议是控制对等实体之间通信的规则
- 服务是"垂真的"，即服务是由下层通过层间接口向上层提供的
- 并非在一层内完成的全部功能都称为服务，只有那些能够被高一层实体"看得见"的功能才称为服务

协议、接口、服务三者之间的关系如图1.9所示。  

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/626bd9b77ec2839f6bcc9d127b243ba971ad814f5bd6d44cd4ca7a6a1070033c.jpg)  
图1.9协议、接口、服务三者之间的关系  

#### 计算机网络服务的分类

##### 面向连接服务与无连接服务  
###### 面向连接服务
- 通信前双方必须先建立连接
- 分配相应的资源（如缓冲区），以保证通信能正常进行
- 传输结束后释放连接和占用的资源
- 这种服务可分为连接建立、数据传输和连接释放三个阶段
- 例如，TCP就是一种面向连接服务的协议

###### 无连接服务
- 通信前双方不需要先建立连接
- 需要发送数据时可直接发送，将每个带有目的地址的包（报文分组）传送到线路上
- 由系统选定路线进行传输
- 这种服务常被描述为"尽最大努力交付"，是一种不可靠的服务
- 例如，IP、UDP就是一种无连接服务的协议

##### 可靠服务和不可靠服务  
###### 可靠服务
- 网络具有纠错、检错、应答机制
- 能保证数据正确、可靠地传送到目的地

###### 不可靠服务
- 网络只是尽量让数据正确、可靠地传送到目的地
- 是一种尽力而为的服务
- 网络的正确性、可靠性要由应用或用户来保障
- 用户收到信息后要判断信息的正确性
- 若不正确，则用户就要把出错信息报告给信息的发送者，以便发送者采取纠正措施
- 通过用户的这些措施，可将不可靠服务变成可靠服务

##### 有应答服务和无应答服务  
###### 有应答服务
- 接收方在收到数据后向发送方给出相应的应答
- 该应答由传输系统内部自动实现，而不由用户实现
- 发送的应答既可以是肯定应答，又可以是否定应答
- 通常在接收到的数据有错误时发送否定应答
- 例如，文件传输服务就是一种有应答服务

###### 无应答服务
- 接收方收到数据后不自动给出应答
- 若需要应答，则由高层实现
- 例如，对于WWW服务，客户端收到服务器发送的页面文件后不给出应答

</ul>

</ul>

## ISO/OSI TCP/IP模型  

<ul>

### OSI参考模型  

<ul>

>pro：OSI参考模型的通信子网各层所包含的中继设备（2016）  

- 国际标准化组织（ISO）提出的网络体系结构模型称为开放系统互连参考模型（OSI/RM），通常简称为OSI参考模型
- OSI参考模型有7层，自下而上依次为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
  - 低三层统称通信子网，是为联网而附加的通信设备，完成数据的传输功能
  - 高三层统称资源子网，相当于计算机系统，完成数据的处理等功能
  - 传输层承上启下

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0007f90cfeedff7909c783165de40e20f9808e61a22237bdf22d1010c48418c4.jpg)  
图1.10OSI参考模型的层次结构  

>pro：OSI参考模型的层次结构（2013、2014、2017、2019）  

#### **物理**层（Physical Layer）

<ul>

- 物理层的传输单位是比特，功能是在物理介质上为数据端设备透明地传输原始比特流
- 物理层主要定义数据终端设备（DTE）和数据通信设备（DCE）的物理与逻辑连接方法
- 物理层接口标准很多，如EIA-232C、EIA/TIARS-449、CCITT的X.21等

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/95bdedaa52206e2c534c5ce90c2d9a507b96d7293774f6465464cbfd14036917.jpg)  
图1.11两个通信结点及它们间的一段通信链路  

##### 物理层研究内容
- 通信链路与通信结点的连接需要一些电路接口，物理层规定了这些接口的一些参数
  - 如机械形状和尺寸、交换电路的数量和排列等
  - 例如笔记本电脑上的网线接口
- 物理层规定了通信链路上所传输的信号的意义和电气特征
  - 例如，若规定信号X代表数字0，则当结点传输0时就发出信号X，而当结点接收到信号X时就知道收到的是0

##### 物理层注意事项
- 传输信息所用的一些物理介质（如双绞线、光缆、无线信道等）并不在物理层协议之内，而在物理层协议下面
- 因此，有人将物理介质当作第0层

</ul>

#### 数据<b><span style="color: deepskyblue;">链路</span></b>层（Data Link Layer）  

<ul>

>pro：OSI参考模型的数据链路层的功能（2022）  

##### **基本**功能
- 传输单位: <span style="color: deepskyblue;">帧</span>
- 两台主机之间的数据传输总是在一段一段的链路上传送的，这就需要使用专门的链路层协议
- 数据链路层将网络层交来的IP分组封装成顿，并且可靠地传输到相邻结点的网络层
- 主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造为逻辑上无差错的数据链路

##### <span style="color: Gold;">错误</span>处理
- 因为外界噪声的干扰，所以原始的物理连接在传输比特流时可能发生错误
- 数据链路层协议应能检测出这些差错，然后将收到的错误信息丢弃

##### <span style="color: green;">流量</span>控制
- 在两个相邻结点之间传送数据时，结点A的发送速率可能比结点B的接收速率快
- 流量控制可以协调两个结点的速率，使结点A的发送速率刚好是结点B的接收速率

##### <span style="color: orange;">广播</span>网络处理
- 广播式网络在数据链路层还要处理新的问题，即如何控制  对共享信道的访问
  - DL层的一个特殊子层一一 介质访问子层 ↑ Deal specifically with this problem

##### 典型协议
- SDLC、HDLC、PPP、STP和帧中继等

</ul>

#### <b><span style="color: DodgerBlue;">网络</span></b>层（Network Layer）  

<ul>

##### 基本功能
- 网络层的传输单位是数据报
- 它关心的是通信子网的运行控制
- 主要任务是将网络层的协议数据单元（分组）从源结点传输到目的结点，为分组交换网上的不同主机提供通信服务
- 关键问题是对分组进行路由选择，并实现流量控制、拥塞控制、差错控制和网际互连等功能

> attention:  
无论是在哪一层传送的数据单元，都可以笼统地用"分组"来表示。  

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/64b7691ecbb524c8f922741a5e0d7779d28ceed9a6a1897443247262e677bc2b.jpg)  
图1.12某网络结构图  

##### <span style="color: orange;">控制</span>功能
- 流量控制
  - 与数据链路层的流量控制的含义一样
  - 都是协调A的发送速率和B的接收速率
- 差错控制
  - 通信结点之间约定的特定检错规则
  - 接收方根据该规则检查接收到的分组是否出错
  - 若出错，则能纠错就纠错，不能纠错就丢弃
- 拥塞控制
  - 若结点都来不及接收分组而丢弃大量分组，导致结点间无法正常通信，网络就处于拥塞状态
  - 网络层要采取措施来缓解这种拥塞

##### 网络互连
- 互联网是由大量异构网络通过路由器相互连接起来的
- 互特网使用的网络层协议是无连接的网际协议（IP）和许多种路由选择协议
- 因此互联网的网络层也称网际层或IP层

##### 网络层协议
- IP、IPX、ICMP、IGMP、ARP、RARP、RIP和OSPF等

</ul>

#### <b><span style="color: green;">传输</span></b>层（Transport Layer）  

<ul>

>pro：OSI参考模型的传输层的功能（2009）  

##### 基本功能
- 传输层也称运输层，负责主机中两个进程之间的通信
- 功能是为端到端连接提供可靠的传输服务
  - 为端到端连接提供流量控制、差错控制、服务质量、数据传输管理等服务

##### 通信特点
- 数据链路层提供的是点到点通信，传输层提供的是端到端通信
- 点到点可理解为主机和主机之间的通信
  - 一个点是指一个硬件地址或IP地址
  - 网络中参与通信的主机是通过硬件地址或IP地址来标识的
- 端到端通信是指运行在不同主机内的两个进程之间的通信
  - 一个进程由一个端口来标识

##### 复用与分用功能
- 通过传输层的屏蔽，高层用户看不到通信子网的交替和变化
- 因为一台主机可同时运行多个进程，所以传输层具有复用和分用的功能
  - 复用是指多个应用层进程可同时使用下面传输层的服务
  - 分用是指传输层将收到的信息分别交付给上面应用层中相应的进程

##### 传输层协议
- TCP、UDP

</ul>

#### <span style="color: GreenYellow;">会话</span>层（Session Layer）  

<ul>

>pro：OSI参考模型的会话层的功能（2019）  

- 会话层充许不同主机上的各个进程之间进行会话
- 这种服务主要为表示层实体或用户进程建立连接，并在连接上有序地传输数据，这就是会话，也称建立同步（SYN）
- 会话层负责管理主机间的会话进程，包括建立、管理和终正进程间的会话
- 会话层包含一种称为检查点的机制来维持可靠会话，使通信会话在通信失效时从检查点继续恢复通信，即断点下载的原理

</ul>

#### <b><span style="color: SlateBlue;">表示</span></b>层（Presentation Layer）  

<ul>

>pro：OSI参考模型的表示层的功能（2013）  

- 表示层主要处理在两个通信系统中交换信息的表示方式
- 不同机器采用的编码和表示方法不同，为了使不同表示方法的数据和信息之间能够互相交换：
  - 表示层采用抽象的标准方法定义数据结构
  - 并采用标准的编码形式
- 此外，数据压缩、加密和解密也是表示层的功能

</ul>

#### <span style="color: orange;">应用</span>层（Application Layer）  

<ul>

- 应用层是OSI参考模型的最高层，是用户与网络的接口
- 应用层为特定类型的网络应用提供访向OS参考模型环境的手段
- 用户的实际应用多种多样，这就要求应用层采用不同的应用协议来解决不同类型的应用要求
- 因此应用层是最复杂的一层，使用的协议也最多
- 典型的协议有：
  - 用于文件传送的FTP
  - 用于电子邮件的SMTP
  - 用于万维网的HTTP等

</ul>

</ul>

### TCP/IP模型  

<ul>

>pro：TCP/IP模型的各层的顺序（2021）  

#### TCP/IP模型的层次结构
- TCP/IP模型从低到高依次为网络接口层（对应OSI参考模型的物理层和数据链路层）、网际层、传输层和应用层（对应OSI参考模型的会话层、表示层和应用层）
- TCP/IP因为得到广泛应用而成为事实上的国际标准
- TCP/IP模型的层次结构及各层的主要协议如图1.13所示
![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c14a9addbd31bfab185f7ddf31fee34a7a506bbe4d93206e83711b8f80157e3f.jpg)  

#### 各层功能
##### 网络接口层
- 功能类似于OSI参考模型的物理层和数据链路层
- 表示与物理网络的接口，但实际上TCP/IP本身并未真正描述这一部分
- 只是指出主机必须使用某种协议与网络连接，以便在其上传输IP分组
- 具体的物理网络可以是：
  - 各种类型的局域网：以太网、令牌环网、令牌总线网等
  - 公共数据网络：电话网、SDH、X.25、帧中继和ATM等
- 作用是从主机或结点接收IP分组，并将它们发送到指定的物理网络上

>pro：TCP/IP模型的网际层的功能（2011、2021）  

##### 网际层
- 是TCP/IP体系结构的关键部分
- 功能上与OSI参考模型的网络层非常相似
- 主要功能：
  - 将分组发往任何网络
  - 为其独立地选择合适的路由
  - 不保证各个分组有序地到达
  - 各个分组的有序和可靠交付由高层负责
- 定义了标准的分组格式和协议IP
  - 当前采用的IP是第4版，即IPv4
  - 下一版本是IPv6

##### 传输层
- 功能同样与OSI参考模型中的传输层类似
- 使得发送端和目的端主机上的对等实体进行会话
- 主要使用两种协议：
  1. 传输控制协议（TCP）
     - 面向连接
     - 传输数据前必须先建立连接
     - 能够提供可靠的交付
     - 数据传输单位是报文段
  2. 用户数据报协议（UDP）
     - 无连接
     - 不保证提供可靠的交付
     - 只能提供"尽最大努力交付"
     - 数据传输单位是用户数据报

##### 应用层
- 包含所有的高层协议：
  - 虚拟终端协议（Telnet）
  - 文件传输协议（FTP）
  - 域名解析服务（DNS）
  - 电子邮件协议（SMTP）
  - 超文本传输协议（HTTP）

#### IP协议的核心地位
- IP是互联网中的核心协议
- TCP/IP可为各式各样的应用提供服务（所谓everything over IP）
- TCP/IP可在各种网络上运行（所谓IP over everything）
- 这是互联网发展到今天规模的重要原因

</ul>

### TCP/IP模型与OSI参考模型的比较  

<ul>

#### 相似之处
- 都采取分层的体系结构，且分层的功能大体相似
- 都是基于独立的协议栈的概念
- 都可解决异构网络的互连，实现不同厂家生产的计算机之间的通信

#### 差别
- 概念定义
  - OSI参考模型精确定义了服务、协议和接口三个主要概念
  - 这与现代的面向对象程序设计思想非常吻合
  - TCP/IP模型在这三个概念上没有明确区分

- 层次结构
  - OSI参考模型是7层模型
  - TCP/IP模型是4层结构
  - TCP/IP模型将表示层和会话层功能合并到应用层
  - 将数据链路层和物理层合并为网络接口层

- 发展过程
  - OSI参考模型先有模型，后有协议规范
  - 通用性良好，适合描述各种网络
  - TCP/IP模型先有协议栈，后建立模型
  - 不适合任何其他的非TCP/IP网络

- 通信模式
  - OSI参考模型：
    - 网络层支持无连接和面向连接的通信
    - 传输层仅有面向连接的通信
  - TCP/IP模型：
    - 网际层仅有一种无连接的通信模式
    - 传输层支持无连接和面向连接两种模式

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a20b555348c66a1d86d4fd42dd6992721d73608bd7121635c924dba4b9b8c816.jpg)  

#### 模型评价
- OSI参考模型的问题：
  - 追求完美的理想状态
  - 导致基于OSI参考模型的软件效率极低
  - 缺乏市场与商业动力
  - 结构复杂，运行效率低

#### 五层协议体系结构
- 综合OSI参考模型和TCP/IP模型的优点
- 采用只有5层协议的体系结构
- 本书采用这种体系结构进行讨论

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/ec6112de998bfabbd24993f5950da08fa636670fe503551cad0412179dfdb9ac.jpg)  

>pro：应用层DNS报文逐层封装的关系（2021）  

#### 协议栈通信过程
- 协议栈特点：
  - 每个协议栈的顶端都是面向用户的接口
  - 下面各层是为通信服务的协议

- 数据传输过程：
  - 用户数据通常是自然语言
  - 通过应用层转化为通信数据
  - 数据在各层间传递时：
    - 作为上层的数据部分（SDU）
    - 加上本层的控制信息（PCI）
    - 组成本层的PDU
  - 层层下放，层层包裹
  - 通过通信线路传输到接收方
  - 接收方逐层拆开"包裹"
  - 最后将数据提交给用户

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0c26307fd09bd47a50dd8f5a89155680090dda15a93f2b1ab530a1e0943cba84.jpg)  

</ul>

</ul>

</ul>

# 本章小结及疑难点  

<ul>

1.互联网使用的IP协议是无连接的，因此其传输是不可靠的。这样容易使人们感到互联网很不可靠。为什么当初不把互联网的传输设计为可靠的呢？  

<ul>

传统电信网的主要用途是电话通信，且普通电话机不是智能的，因此电信公司必须花费巨大的代价将电信网设计得非常可靠，以保证用户的通信质量。  

数据的传送显然必须可靠。当初设计ARPAnet时，很重要的讨论内容之一是“谁应当负责数据传输的可靠性？”一种意见是主张像电信网那样，由通信网络负责数据传输的可靠性（因为电信网的发展史及技术水平已经证明，人们可将网络设计得相当可靠）。另一种意见则主张由用户主机负责数据传输的可靠性，理由是这样可使计算机网络便宜、灵活。  

计算机网络的先驱认为，计算机网络和电信网的一个重大区别是终端设备的性能差别很大。thus，他们采用了“端到端的可靠传输”策略，即在传输层使用面向连接的TCP协议，这样既能使网络部分价格便宜且灵活可靠，又能保证端到端的可靠传输。  

</ul>

2.端到端通信和点到点通信有什么区别？  

<ul>

本质上说，由物理层、数据链路层和网络层组成的通信子网为网络环境中的主机提供点到点的服务，而传输层为网络中的主机提供端到端的通信。  

直接相连的结点之间的通信称为点到点通信，它只提供一台机器到另一台机器之间的通信，不涉及程序或进程的概念。同时，点到点通信并不能保证数据传输的可靠性，也不能说明源主机与目的主机之间是哪两个进程正在通信，这些工作都由传输层来完成。  

端到端通信建立在点到点通信的基础上，由一段段点到点通信信道构成，以完成应用程序（进程）之间的通信。“端”是指用户程序的端口，端口号标识了应用层中的不同进程。  

</ul>

3.如何理解传输速率和传播速率？  

<ul>

传输速率是指主机或路由器在数字信道上发送数据的速率，也称传输率、数据率或比特率，单位是比特/秒（b/s），或干比特/秒（kb/s）、兆比特/秒（Mb/s）、吉比特/秒（Gb/s）等。  
> attention:  

在通信领域中表示速率时， $\mathbf{k}=10^{3}$  $\mathrm{M}=10^{6}$  $G=10^{9}$  $\mathrm{T}=10^{12}$ 。表示存储容量或文件大小时， 
- $\mathtt{K}=2^{10}=1024$  $\scriptstyle\mathbf{M}=2^{20}$  $\mathrm{G}=2^{30}$  $\mathrm{T}=2^{40}$ 
与通信领域中的表示方式不同。  

传播速率是指电磁波在信道中传播的速率，单位是米/秒（ $._{\mathrm{m/s}}$ ）或千米/秒（ $(\mathrm{km}/\mathrm{s})$  

在图1.17中，假定链路的传播速率为 $2{\times}10^{8}\mathrm{m/s}$ ，这相当于电磁波在该介质中 $1\mu\mathrm{s}$ 可向前传播 $200\mathrm{m}$ 。若链路带宽为 $1\mathrm{{Mb/s}}$ ，则主机在 $1\mu\mathrm{s}$ 内可向链路发送1比特的数据。当 $t=0$ 时，开始向链路发送数据：当 $t=1\mu\mathrm{s}$ 时，信号传播到 $200\mathrm{m}$ 处，注入链路1比特：当 $t=2\mu\mathrm{s}$ 时，信号传播到 $400\mathrm{m}$ 处，注入链路共2比特：当 $t=3\mu\mathrm{s}$ 时，信号传播到 $600\mathrm{m}$ 处，注入链路共3比特。  

从图1.17可以看出，在一段时间内链路中有多少比特取决于带宽（或传输速率），而1比特“跑”了多远取决于传播速率。  

![]`(https://cdn-mineru.openxlab.org.cn/model-mineru/prod/0f85059af28cb65ea81407dcb3fc5444431a016956a56fcf332ccd22ecceba5f.jpg)  
图1.17传输速率、带宽和传播速率三者的区别

</ul>

</ul>

