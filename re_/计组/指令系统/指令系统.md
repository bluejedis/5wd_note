# above  

## 【考纲内容】  

（一）指令格式的基本概念（二）指令格式（三）寻址方式（四）数据的对齐和大/小端存放方式（五）CISC和RISC的基本概念（六）高级语言程序与机器级代码之间的对应编译器、汇编器与链接器的基本概念：选择结构语句的机器级表示循环结构语句的机器级表示：过程（函数）调用对应的机器级表示  

## 【复习提示】  

- 指令系统的重要性：
  - 是表征计算机性能的重要因素。

- 需要掌握的内容：
  - 各种寻址方式的特点及有效地址的计算。
  - 三种偏移寻址的计算：相对寻址、基址寻址和变址寻址。
  - CISC与RISC的特点与区别。

- 2022年大纲新增内容：
  - 机器级表示。
  - 能够读懂机器级代码。

- 考试题型：
  - 可能出选择题。
  - 可能结合其他章节出有关指令的综合题。

- 指令相关知识点的重要性：
  - 指令格式、机器指令和指令寻址方式与CPU指令执行过程紧密相关。
  - 需要引起重视。


在学习本章时，请读者思考以下问题  

1）什么是指令？什么是指令系统？为什么要引入指令系统？2）一般来说，指令分为哪些部分？每部分有什么用处？3）对于一个指令系统来说，寻址方式多和少有什么影响？请读者在本章的学习过程中寻找答案，本章末尾会给出参考答案。  

# <span style="color: LightSkyBlue;">指令</span><span style="color: deepskyblue;">系统</span>  

## <span style="color: LightSkyBlue;">指令</span><span style="color: LimeGreen;">集</span>  <span style="color: silver;">体系<span style="color: green;">结构  <span style="color: LightSkyBlue;">I</span><span style="color: LimeGreen;">S<span style="color: Gold;">A</span>

>pro：指令集体系结构（ISA）规定的内容（2022）  
<ul>

###  <span style="color: silver;">基本概念

- <span style="color: LightSkyBlue;">I</span><span style="color: LimeGreen;">S</span><span style="color: Gold;">A</span>
  -  <span style="color: silver;">完整定义了</span><u>软件</u>和<u>硬件</u>之间的 <span style="color: LimeGreen;">接口</span>
      - <span style="color: gray; font-size: 14px;">机器语言或汇编语言程序员应熟悉</span>
  - <span style="color: LightSkyBlue;">指令</span><span style="color: deepskyblue;">系统</span> is（ISA）最<u>核心</u>
- <span style="color: LightSkyBlue;">指令</span><span style="color: deepskyblue;">系统</span> /<span style="color: LightSkyBlue;">指令</span><span style="color: LimeGreen;">集</span> 
  - 一台计算机的所有<span style="color: LightSkyBlue;">指令</span>的 <span style="color: LimeGreen;">集合</span>
-  <span style="color: silver;">机器指令（简称<span style="color: LightSkyBlue;">指令</span>
   - 指示 <span style="color: silver;">计算机执行某种</span> <span style="color: LimeGreen;">操作</span>'<span style="color: LightSkyBlue;">命令</span>

###  <span style="color: LightSkyBlue;">I</span><span style="color: LimeGreen;">S</span><span style="color: Gold;">A</span> <span style="color: silver;">规定内容</span>
> Instruction Set Architecture，指令集体系结构
<ul>

#### <span style="color: LightSkyBlue;">指令</span>
- 格式
- 寻址方式
- 操作类型
- 每种操作对应的操作数的相应规定

####  <span style="color: LimeGreen;">操作</span><span style="color: LightSkyBlue;">数</span>
- 类型
- 寻址方式
- 存放方式（大端/小端）

#### 硬件<span style="color: Gold;">资源</span>
- 程序可访问的寄存器
  - 编号
  - 个数
  - 位数
- 存储空间
  - 大小
  - 编址方式

####  <span style="color: LimeGreen;">执行<span style="color: Gold;">控制
- 指令执行过程的控制方式
  - 程序计数器
  - 条件码定义
</ul>

### <span style="color: LightSkyBlue;">I</span><span style="color: LimeGreen;">S</span><span style="color: Gold;">A</span> <span style="color: silver;">& 程序 <span style="color: LimeGreen;">开发</span>
<ul>

#### ISA与机器级程序
- <span style="color: green;">规定</span>了机器级程序的格式
- 机器语言或汇编语言程序员必须对机器的ISA非常熟悉

#### 高级语言编程
- 大多数程序员使用高级语言（如C/C++/Java）编写程序
  - 开发效率更高
  - 不易出错
- 局限性：
  - 抽象层太高
  - 隐藏机器级程序细节
  - 难以利用机器结构相关优化

#### ISA知识的重要性
- 程序员对ISA和底层硬件实现细节有充分了解
- 有助于编制高性能程序
</ul>
</ul>

##  <span style="color: silver;">基本格式
<ul>

###  <span style="color: silver;">概念
- 一条指令就是机器语言的一个语句，它是一组有意义的二进制代码
- 一条指令通常包括两部分：
  - 操作码字段
  - 地址码字段

####  <span style="color: LimeGreen;">操作</span><span style="color: green;">码</span>   <span style="color: silver;">& <span style="color: DarkRed;">地址</span>码
- <span style="color: LimeGreen;">操作</span><span style="color: green;">码</span>
  - 指出该指令应执行什么操作以及具有何种功能
  - 是识别指令、了解指令功能及区分操作数地址内容等的关键信息
  - 例如：
    - 指出是算术加运算还是算术减运算
    - 是程序转移还是返回操作
- <span style="color: silver;"><span style="color: DarkRed;">地址</span>码</span>
  - 给出被操作的信息（指令或数据）的地址
  - 包括：
    - 参加运算的一个或多个操作数的地址
    - 运算结果的保存地址
    - 程序的转移地址
    - 被调用子程序的入口地址等

#### <span style="color: silver;">~ 字长</span>
- 定义：
  - 一条指令所包含的二进制代码的位数
- 决定因素：
  - 操作码的长度
  - 地址码的长度
  - 地址码的个数
- 与机器字长的关系：
  - 可以等于机器字长
  - 可以大于或小于机器字长
- 分类：
  - 单字长指令：指令长度等于机器字长
  - 半字长指令：指令长度等于半个机器字长
  - 双字长指令：指令长度等于两个机器字长

>attention: 
- 指令长度不同会影响取指令时间开销：
  - 单字长指令：
    - 只需访存1次
    - 能将指令完整取出
    - 耗费1个存取周期
  - 双字长指令：
    - 需要访存2次
    - 才能完整取出指令
    - 耗费2个存取周期
#### 指令字结构
- 定长指令字结构：
  - 所有指令的长度都相等
  - 特点：执行速度快，控制简单
- 变长指令字结构：
  - 各种指令的长度随指令功能而异
- 注意：因为主存一般是按字节编址的，所以指令字长通常为字节的整数倍

>pro：根据指令格式及相关编码条件组合成机器代码（2015）

### 指令格式分类

#### 零地址指令
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/6e7552f06b4d8317fc022359d2dcccb811aec4c3314eb4cd1ac1ec714e795bd3.jpg)
- 只给出操作码OP，没有显式地址
- 两种可能：
  - 不需要操作数的指令
    - 如空操作指令、停机指令、关中断指令等
  - 零地址的运算类指令（用在堆栈计算机中）
    - 参与运算的两个操作数从栈顶和次栈顶弹出
    - 送到运算器进行运算
    - 运算结果压入堆栈

#### 一地址指令
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/f73beb07fd477d00ecf244bb03d345248115ffa6dad3968d55fb69658646a4ca.jpg)
- 两种常见形态：
  - 只有目的操作数的单操作数指令：
    - 按A₁地址读取操作数
    - 进行OP操作后，结果存回原地址
    - 指令含义：OP(A₁)→A₁
    - 如：加1、减1、求反、求补、移位等
  - 隐含约定目的地址的双操作数指令：
    - 按指令地址A₁读取源操作数
    - ACC（累加器）提供另一个操作数
    - 运算结果存放在ACC中
    - 指令含义：(ACC)OP(A₁)→ACC

>pro：地址位数与寻址范围的关系（2010、2021）

##### 一地址指令的寻址范围
- 若指令字长为32位：
  - 操作码占8位
  - 1个地址码字段占24位
  - 操作数的直接寻址范围为2²⁴=16M
- 访存次数：
  - 若地址码字段均为主存地址
  - 需要3次访存：
    - 取指令1次
    - 取操作数1次
    - 存结果1次

#### 二地址指令
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/808143d9dc4a64a19f32b18f99d45ecad816da4b5a2564cee34b907da02c8e67.jpg)
- 指令含义：(A₁)OP(A₂)→A₁
- 使用场景：
  - 常用的算术和逻辑运算指令
  - 需要两个操作数
  - 目的操作数地址用于保存运算结果

##### 二地址指令的寻址范围
- 若指令字长为32位：
  - 操作码占8位
  - 两个地址码字段各占12位
  - 每个操作数的直接寻址范围为2¹²=4K
- 访存次数：
  - 若地址码字段均为主存地址
  - 需要4次访存：
    - 取指令1次
    - 取两个操作数2次
    - 存结果1次

#### 三地址指令
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/964f896e4265099daa90e4a7313c3f27dbada8cdcabb04ced0efe9b9d5d4944a.jpg)
- 指令含义：(A₁)OP(A₂)→A₃

##### 三地址指令的寻址范围
- 若指令字长为32位：
  - 操作码占8位
  - 3个地址码字段各占8位
  - 每个操作数的直接寻址范围为2⁸=256
- 访存次数：
  - 若地址码字段均为主存地址
  - 需要4次访存：
    - 取指令1次
    - 取两个操作数2次
    - 存结果1次

#### 四地址指令
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/56bca1a6922d69a95d02641971447a3f6f573122ef2321a9000c316913151d9c.jpg)
- 指令含义：
  - (A₁)OP(A₂)→A₃
  - A₄=下一条将要执行指令的地址

##### 四地址指令的寻址范围
- 若指令字长为32位：
  - 操作码占8位
  - 4个地址码字段各占6位
  - 每个操作数的直接寻址范围为2⁶=64
- 访存次数：
  - 若地址码字段均为主存地址
  - 需要4次访存：
    - 取指令1次
    - 取两个操作数2次
    - 存结果1次
</ul>

## 定长操作码指令格式  

>pro：定长操作码的指令条数（2015）  

- 定长操作码指令特点：
  - 在指令字的最高位部分分配固定的若干位表示操作码
  - 一般n位操作码字段的指令系统最大能够表示2ⁿ条指令
  - 优点：
    - 简化计算机硬件设计
    - 提高指令译码和识别速度
  - 适用场景：
    - 当计算机字长为32位或更长时的常规用法

## <span style="color: green;">扩展</span>操作码指令格式  

>pro：扩展操作码的设计与分析（2017、2021、2022）  

### 基本概念
- 设计目的：
  - 在指令字长有限的前提下保持丰富的 指令种类
- 特点：
  - 操作码字段 <span style="color: LightSkyBlue;">位数</span> 不**fix**
  - 分散放在 指令字的不同位置上
  - 操作码 长度 随地址码的减少而增加

### 具体实现
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/b10a369778010289fef7ffaa5f77b8dcc6e481322d548dc450d59062bbc00886.jpg)  
操作码的位数随地址数的减少而增加  

- 示例分析（16位指令字长）：
  - 基本结构：
    - 4位基本操作码字段OP
    - 3个4位长的地址字段A₁、A₂、A₃
  - 指令分配：
    - 三地址指令：15条（1111留作扩展）
    - 二地址指令：15条（11111111留作扩展）
    - 一地址指令：15条（111111111111留作扩展）
    - 零地址指令：16条

### 注意事项
- 关键原则：
  - 不允许短码是长码的前缀
  - 各指令的操作码不能重复
- 优化建议：
  - 使用频率高的指令分配较短操作码
  - 使用频率低的指令分配较长操作码

## 指令的操作类型  

### 数据传送  
- 主要指令类型：
  - 寄存器之间的传送（MOV）
  - 从内存单元读取数据到CPU寄存器（LOAD）
  - 从CPU寄存器写数据到内存单元（STORE）
  - 进栈操作（PUSH）
  - 出栈操作（POP）

### 算术和逻辑运算  
- 主要指令类型：
  - 算术运算：
    - 加（ADD）
    - 减（SUB）
    - 乘（MUL）
    - 除（DIV）
    - 加1（INC）
    - 减1（DEC）
  - 逻辑运算：
    - 与（AND）
    - 或（OR）
    - 取反（NOT）
    - 异或（XOR）

### 移位操作  
- 主要类型：
  - 算术移位
  - 逻辑移位
  - 循环移位

### 转移操作  

>pro：转跳指令、调用和返回指令、条件转移指令的区分（2019）  

- 主要指令类型：
  - 无条件转移（JMP）
  - 条件转移（BRANCH）
  - 调用（CALL）
  - 返回（RET）
  - 陷阶（TRAP）

- 指令特点：
  - 无条件转移：任何情况下都执行转移操作
  - 条件转移：仅在特定条件满足时执行转移
    - 转移条件：某个标志位的值或几个标志位的组合
  - 调用指令vs转移指令：
    - 调用指令：需保存返回地址，子程序结束后返回主程序
    - 转移指令：不返回执行

### 输入输出操作  
- 主要功能：
  - 完成CPU与外部设备的数据交换
  - 传送控制命令及状态信息 
  

# <span style="color: green;">寻址</span>方式  

- 寻址方式：
  - 定义：寻找指令或操作数有效地址的方式
  - 作用：确定
    - 本条指令的数据地址
    - 下一条待执行指令的地址
  - 分类：
    - 指令寻址
    - 数据寻址
## 指令寻址和数据寻址

寻找下一条将要执行的指令地址称为指令寻址；寻找本条指令的数据地址称为数据寻址。

### 指令寻址

指令寻址方式有两种：一种是顺序导址方式，另一种是跳跃寻址方式。

#### 顺序寻址
- 通过程序计数器PC加1（1条指令的长度），自动形成下一条指令的地址

>pro：PC自增大小与编址方式、指令字长的关系（2013、2014、2019、2023）  

>attention: 

- PC自增的大小与编址方式、指令字长有关
  - 现代计算机通常是按字节编址的
    - 若指令字长为16位，则PC自增为 $(\mathrm{PC})+2$
    - 若指令字长为32位，则PC自增为 $(\mathrm{PC})+4,$

#### 跳跃寻址
- 通过转移类指令实现
  - 跳跃定义：
    - 由本条指令给出下条指令地址的计算方式
    - 是否跳跃可能受到状态寄存器的控制
  - 跳跃的方式：
    - 绝对转移
      - 地址码直接指出转移目标地址
    - 相对转移  
      - 地址码指出转移目的地址相对于当前PC值的偏移量
  - 转移指令执行结果：
    - 修改PC值
    - CPU根据PC的内容去主存取下一条指令
### 数据寻址

>pro：指令格式中各字段的位数分析（2020）  

- 数据寻址是指：
  - 如何在指令中表示一个操作数的地址
  - 怎样计算出操作数的地址
- 数据寻址的方式较多，为区别各种方式：
  - 通常在指令字中设置一个寻址特征字段
  - 用来指明属于哪种寻址方式（其位数决定了寻址方式的种类）

>pro：指令格式中寻址特征字段的作用（2023）  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/cc57f57875406369a446ee41b6e46ac9b01777329de41e632ddfab7ec83264fd.jpg)  

- 指令中的地址码字段并不代表操作数的真实地址
  - 这种地址称为形式地址（A）
  - 形式地址结合寻址方式，可以计算出操作数在存储器中的真实地址
    - 这种地址称为有效地址（EA）
- 不同寻址方式的形式地址位数决定：
  - 若为立即寻址，则形式地址的位数决定了操作数的范围
  - 若为直接寻址，则形式地址的位数决定了可寻址的范围
  - 若为寄存器寻址，则形式地址的位数决定了通用寄存器的最大数量
  - 若为寄存器间接寻址，则寄存器的位数决定了可寻址的范围

>attention: 

（A）表示地址为A的数值，A既可以是寄存器编号，又可以是内存地址。
## 常见的数据寻址方式

### 基本寻址方式
#### 隐含寻址
- 不明显地给出操作数的地址，而是隐含操作数的地址
  - 例如，单地址指令格式隐含约定第二个操作数由累加器(ACC)提供
  - 指令中只明显指出第一个操作数的地址

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/eb95a905f61e44cad56b518a1aa375ef438a60ca7ed3fc676e2fa55c6f573d41.jpg)  
图4.2隐含寻址  

- 优缺点
  - 优点：有利于缩短指令字长
  - 缺点：需增加存储操作数或隐含地址的硬件

#### 立即（数）寻址
>pro：立即寻址的概念（2023）

- 指令字中的地址字段指出的不是操作数的地址，而是操作数本身
  - 也称立即数，采用补码表示
  - #表示立即寻址特征，A就是操作数
- 优缺点
  - 优点：指令在执行阶段不访存，指令执行速度最快
  - 缺点：A的位数限制了立即数的范围

#### 直接寻址
- 指令字中的形式地址A就是操作数的真实地址EA
  - EA = A

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/948183c5b772d6544c6bec9a19645480a2b25ccbad62d507552486df04009957.jpg)  

- 优缺点
  - 优点
    - 简单，不需要专门计算操作数的地址
    - 指令在执行阶段仅需访存一次
  - 缺点
    - A的位数限制了该指令操作数的寻址范围
    - 操作数的地址不易修改

### 间接寻址类
#### 间接寻址
- 指令的地址字段给出的是操作数有效地址所在主存单元的地址
  - 即操作数地址的地址
  - EA = (A)

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/297661d0b53d517f5369db6eeea0399b48288d259fb0194ce89d2cff392ca596.jpg)  
图4.5间接寻址  

- 优缺点
  - 优点
    - 可扩大寻址范围
    - 便于编制程序
  - 缺点：指令在执行阶段要多次访存

#### 寄存器寻址
- 与直接寻址原理相同，但访问寄存器而非主存
  - 指令的地址字段给出操作数所在寄存器的编号
  - EA = Ri

>pro：寄存器编号位数与寄存器数量的关系（2022）  

- 优缺点
  - 优点
    - 执行速度快，不用访存
    - 指令字长较短
  - 缺点
    - 寄存器价格昂贵
    - CPU寄存器数量有限

#### 寄存器间接寻址
>pro：寄存器间接寻址的取数操作（2010）  

- 综合了间接寻址和寄存器寻址特点
  - Ri所指寄存器给出操作数所在主存单元的地址
  - EA = (Ri)

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/92cc364b37cca2cace4edc484a7917ca840b456ec8c78df2714108a04df0e6ef.jpg)  
图4.6寄存器寻址  

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/71cf46d10de7a2353718ca3f208d5dd43920b00188d4ad2d26638c7036ec9415.jpg)  
图4.7寄存器间接寻址  

- 特点比较
  - 相比间接寻址
    - 扩大了寻址范围
    - 减少了访存次数
  - 相比寄存器寻址
    - 执行阶段需要访存获得操作数

### 偏移寻址类
#### 相对寻址
>pro：相对寻址的偏移量或目标地址的计算（2009、2013、2014、2019、2023）  

- PC内容加上指令格式中的形式地址A形成操作数的有效地址
  - EA = (PC) + A
  - A是相对于当前PC值的偏移量，可正可负，补码表示

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/54a79a897f2ebe46f3c3320ba9fc90c8d14eba5a2917c433c88919cf0d1c4e2d.jpg)  
图4.8相对寻址  

- A的位数决定操作数的寻址范围
- 优点
  - 操作数地址不固定，随PC值变化
  - 与指令地址保持固定偏移量
  - 便于程序浮动
- 广泛应用于转移指令

>pro：相对寻址转跳范围的计算（2010、2013、2014）  

>attention: 

对于转移指令JMPA，若指令的地址为X，且占2B，则在取出该指令后，PC的值会增2，即 $(\mathrm{PC})\,{=}\,\mathrm{X}+2$ ，这样在执行完该指令后，会自动跳转到 $\mathrm{X}+2+\mathrm{A}$ 的地址继续执行。  

#### 基址寻址
>pro：基址寻址的EA的计算（2019）  

- 基址寄存器内容加上指令字中的形式地址A形成操作数的有效地址
  - EA = (BR) + A
  - 基址寄存器可以是专用寄存器或通用寄存器

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a34564d3543b6f2ccacb8cfb471b140348d32097e27bbf6b321ab8f9a9a2be06.jpg)  
图4.9基址寻址  

- 特点
  - 面向操作系统
  - 内容由操作系统或管理程序确定
  - 执行过程中基址寄存器内容不变
- 优点
  - 可以扩大寻址范围
  - 有利于多道程序设计
  - 可用于编制浮动程序
- 缺点：偏移量位数较短

#### 变址寻址
>pro：变址寻址的EA的计算（2013），先变址后间址方式的EA的计算（2016）  

- 变址寄存器内容加上指令字中的形式地址A形成操作数的有效地址
  - EA = (IX) + A
  - 可用专用变址寄存器或通用寄存器

>pro：变址寻址的适用场景（2017）  

- 特点
  - 面向用户
  - 执行过程中变址寄存器内容可变
  - 形式地址A不变

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/9f0e1bf068edf0a515fc2ed92442f6f857a8030bab1164982e17c514ba92116c.jpg)  
图4.10变址寻址  

>pro：变址寻址访问数组的过程（2018）  

- 与基址寻址的区别
  - 基址寻址
    - 面向系统
    - 基址寄存器内容不可变
    - 指令字中A可变
  - 变址寻址
    - 面向用户
    - 变址寄存器内容可变
    - 指令字中A不可变

>pro：偏移寻址的范畴（2011）  

- 偏移寻址包括
  - 相对寻址
  - 基址寻址
  - 变址寻址

### 特殊寻址方式
#### 堆栈寻址
- 堆栈特点
  - 特定存储区域
  - 后进先出(LIFO)原则
  - 使用堆栈指针(SP)管理
- 堆栈类型
  - 硬堆栈(寄存器堆栈)
    - 成本高
    - 不适合大容量
  - 软堆栈(主存区域)
    - 成本低
    - 最常用
- 操作特点
  - 大部分指令表现为无操作数形式
  - 隐含使用SP
  - 自动完成SP的加减操作

表4.1寻址方式、有效地址及访存次数
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/c51f3e89ddc451b47a9e622c8b801b80139caf0bb46af25e8b2187d5cd2dfd58.jpg)  
![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e1c50194cc3786f302b53c78b63af2b45a119ca8380862b67f5dcabb0710cde4.jpg)  
  

