 # above

## 【考纲内容】  

总线的基本概念总线的组成及性能指标总线事务和定时  

## 【复习提示】  

本章的知识点较少，通常以选择题的形式出现，特别是总线的特点、猝发传输方式、性能指标、定时方式及常见的总线标准等。总线带宽的计算也可能结合其他章节出综合题。  

在学习本章时，请读者思考以下问题  

1）引入总线结构有什么好处？2）引入总线结构会导致什么问题？如何解决？请读者在学习本章的过程中寻找答案，本章末尾会给出参考答案。  

# 总线概述  

- 早期计算机的连接方式
  - 各部件之间通过单独连线互连
  - 这种方式称为分散连接
- 发展到总线连接
  - 原因：I/O设备种类和数量增多
  - 目的：更好地解决I/O设备和主机之间连接的灵活性
- 进一步发展
  - 提出各类总线标准
  - 目的：简化设计
## 基本概念  

### 定义  
- 总线是一组能为多个部件分时和共享的公共信息传送线路
- 两个特点:
  - 分时：同一时刻只充许有一个部件向总线发送信息
  - 共享：总线上可以挂接多个部件，各个部件之间互相交换的信息都可通过这组线路分时共享

### 总线设备  
- 按对总线控制功能分为:
  - 主设备：发出总线请求且获得总线控制权的设备
  - 从设备：被主设备访问的设备，只能响应主设备发来的总线命令

### 特性  
- 机械特性（尺寸、形状）
- 电气特性（传输方向和有效的电平范围）
- 功能特性（每根传输线的功能）
- 时间特性（信号和时序的关系）

## 分类  

### 按功能层次
> pro： 总线相关的概念与特点（2016、2017）  

#### 片内总线
- 芯片内部的总线
- 用于CPU芯片内部各寄存器之间及寄存器与ALU的连接

#### 系统总线
- 计算机系统内各功能部件之间相互连接的总线
- 按传输信息内容分为:
  > pro：数据总线上传输的内容（2011）  
  - 数据总线
    - 用途：传输数据、指令和中断类型号等
    - 特点：双向传输
    - 位数：反映一次能传送的数据位数
  - 地址总线
    - 用途：指出数据源或目的地址
    - 特点：单向传输
    - 位数：反映最大寻址空间
  - 控制总线
    - 用途：传输各种命令、反馈和定时信号
    - 典型信号：时钟、复位、总线请求/充许等

注意区分：
- 数据通路：各功能部件通过数据总线连接形成的数据传输路径
- 数据总线：数据传输的媒介

#### I/O总线
- 用途：连接中低速I/O设备
- 特点：通过I/O接口与系统总线相连
- 目的：将低速设备与高速总线分离
- 例如：USB、PCI总线

#### 通信总线
- 又称外部总线
- 用途：计算机系统之间或与其他系统的信息传送

### 按时序控制方式 

#### 同步总线
- 使用统一时钟进行同步
- 在规定时钟节拍内进行规定总线操作

#### 异步总线
- 无统一时钟
- 使用信号握手方式协调
- 总线操作时序不固定

### 按数据传输方式

#### 串行总线
- 结构：一条双向或两条单向数据线
- 传输：按比特位串行顺序
- 特点：
  - 效率低于并行总线
  - 适合长距离通信
  - 要求不高

#### 并行总线
- 结构：多条双向数据线
- 传输：多比特位同时传输
- 特点：
  - 效率较高
  - 存在延迟和干扰问题
  - 适合近距离通信

> attention  

并行总线并不一定总比串行总线快，它们适合不同的场景。并行总线由于是多个数据位同时传输，需要考虑数据的协同性，以及线路之间的相互干扰，导致工作频率无法持续提高。而串行总线可通过不断提高工作频率来提高传输速度，使其速度最终超越并行总线的速度。

## 系统总线的结构  

### 按结构分类

#### 单总线结构  
- 基本特征：
  - CPU、主存、I/O设备都挂在一组总线上
  - 允许设备间直接交换信息
  - 无需中间设备干预
- 注意事项：
  - 单总线不是指只有一根信号线
  - 可分为地址总线、数据总线和控制总线

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/a8b75e0bcbcbe7c1e22d71e2fa26222c4fe36d1dfe9f77fe38f2dbbcd9c3075a.jpg)  
图6.1单总线结构  

- 优点：
  - 结构简单
  - 成本低
  - 易于接入新设备
- 缺点：
  - 带宽低
  - 负载重
  - 只能争用唯一总线
  - 不支持并发传送

#### 双总线结构  
- 组成：
  - 主存总线：CPU、主存和通道间传送数据
  - I/O总线：外部设备与通道间传送数据

- 优点：
  - 实现存储器总线和I/O总线分离
  - 低速I/O设备从单总线分离
- 缺点：
  - 需要增加通道等硬件设备

#### 三总线结构  
- 组成：
  - 主存总线：CPU和内存间传送信息
  - I/O总线：CPU和外设间通信
  - DMA总线：内存和高速外设间直接传送数据

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/d7065d4dc41e8445bd893d3f0057b7a4fbb7dfb06e816e4830f2970c62d12561.jpg)  
图6.2双总线结构  

- 优点：
  - 提高I/O设备性能
  - 提高系统吞吐量
- 缺点：
  - 任意时刻只能使用一种总线
  - 系统工作效率较低

### 常见总线标准

> pro：总线标准的英文缩写（2010）  

#### 系统总线
##### 并行总线
###### ISA (Industry Standard Architecture)
- 工业标准体系结构
- 特点：
  - 最早出现的系统总线
  - 传输速率低
  - CPU占用率高
  - 占用硬件中断资源

###### EISA (Extended Industry Standard Architecture)
- 扩展的ISA
- 特点：
  - 对ISA完全兼容
  - 支持突发传送

> pro：区分设备总线和局部总线（2013）  

#### 局部总线
##### 并行总线
###### VESA (Video Electronics Standards Association)
- 视频电子标准协会
- 特点：
  - 32位局部总线
  - 针对多媒体PC高速传送需求

###### PCI (Peripheral Component Interconnect)
- 外部设备互连
- 应用：显卡、声卡、网卡等
- 特点：
  - 高速外围总线
  - 与处理器时钟频率无关
  - 支持即插即用

###### AGP (Accelerated Graphics Port)
- 加速图形接口
- 用途：连接主存和图形卡

##### 串行总线
###### PCI-E (PCI-Express)
- 特点：
  - 高速串行双通道传输
  - 支持双向传输模式
  - 支持全双工模式

> pro：PCI-E总线的特点（2017）  

#### 设备总线
##### 串行总线
###### RS-232C
- 用途：数据终端设备和数据通信设备间的标准接口

###### USB (Universal Serial Bus)
- 通用串行总线
- 特点：
  - 即插即用
  - 热插拔
  - 强连接能力

> pro：USB总线的特点（2012）  

##### 并行总线
###### PCMCIA
- 用途：笔记本电脑接口标准
- 特点：即插即用

###### IDE (Integrated Drive Electronics)
- 集成设备电路
- 又称ATA
- 用途：连接硬盘和光驱

###### SCSI (Small Computer System Interface)
- 小型计算机系统接口
- 用途：计算机和周边设备间接口

##### 串行总线
###### SATA (Serial Advanced Technology Attachment)
- 串行高级技术附件
- 用途：串行硬件驱动器接口
## 总线的性能指标  

### 时钟相关指标
- 总线时钟周期
  - 即机器的时钟周期
  - 计算机有一个统一的时钟，以控制整个计算机的各个部件
  - 总线也要受此时钟的控制

- 总线时钟频率
  - 即机器的时钟频率
  - 它为时钟周期的倒数

### 传输相关指标
- 总线传输周期
  - 指一次总线操作所需的时间
  - 包括:
    - 申请阶段
    - 寻址阶段
    - 传输阶段
    - 结束阶段
  - 通常由若干总线时钟周期构成

- 总线工作频率
  - 总线上各种操作的频率，为总线周期的倒数
  - 实际上指1秒内传送几次数据
  - 若总线周期 $=N$ 个时钟周期，则总线的工作频率 $=$ 时钟频率/N
  - 若一个时钟周期可以传送 $K$ 次数据，则总线工作频率是总线时钟频率的 $K$ 倍

### 物理特性指标
- 总线宽度
  - 也称总线位宽
  - 是总线上能够同时传输的数据位数
  - 通常指数据总线的根数，如32根称为32位总线

> pro：总线带宽的相关计算（2009、2013、2014、2019、2020）  

- 总线带宽
  - 单位时间内总线上最多可传输数据的位数
  - 通常用每秒传送信息的字节数来衡量，单位可用字节/秒（B/s）表示
  - 计算公式：总线带宽 $=$ 总线工作频率 $\times($ (总线宽度/8）

- 总线复用
  - 一种信号线在不同的时间传输不同的信息
  - 例如：地址/数据线复用
  - 优点：使用较少的线传输更多的信息，节省空间和成本

- 信号线数
  - 包含：
    - 地址总线
    - 数据总线
    - 控制总线
  - 三种总线数的总和

> pro：提高总线带宽的办法（2018）  

### 主要性能指标总结
- 最主要的三个性能指标：
  - 总线宽度
  - 总线工作频率
  - 总线带宽
- 三者关系：总线带宽 $=$ 总线宽度 $\times$ 总线工作频率
- 示例：总线工作频率为22MHz，总线宽度为16位，则总线带宽 $\scriptstyle=22\mathbf{M}\times(16/8)=44\mathbf{M}\mathrm{B/s}$# 总线事务和定时  

## 总线事务  

- 从请求总线到完成总线使用的操作序列 → 总线事务
  - 一个总线周期中发生的一系列活动
- 典型的总线事务包括:
  - 请求操作
  - 仲裁操作
  - 地址传输
  - 数据传输
  - 总线释放

### 总线事务阶段
- 请求阶段
  - 主设备（CPU或DMA）发出总线传输请求
  - 获得总线控制权
- 仲裁阶段
  - 总线仲裁机构决定将下一个传输周期的总线使用权授予某个申请者
- 寻址阶段
  - 主设备通过总线给出要访问的从设备地址及有关命令
  - 启动从模块
- 传输阶段
  - 主模块和从模块进行数据交换
  - 可单向或双向进行数据传送
- 释放阶段
  - 主模块的有关信息均从系统总线上撤除
  - 让出总线使用权

> pro：非突发传送的时间分析（2023）  

### 数据传送方式
#### 非突发传送
- 每个传送周期内都先传送地址，再传送数据
- 主、从设备之间通常每次只能传输一个字长的数据

> pro：突发传送的概念（2014），突发传送的时间分析（2012、2013）  

#### 突发传送
- 能够进行连续成组数据的传送
- 寻址阶段发送连续数据单元的首地址
- 传输阶段传送多个连续单元的数据
- 每个时钟周期可以传送一个字长的信息
- 不释放总线，直到一组数据全部传送完毕

## 总线定时  

总线定时是指总线在双方交换数据的过程中需要时间上配合关系的控制，这种控制称为总线定时，其实质是一种协议或规则。

> pro：各种总线定时方式的特点（2015、2021）  

### 同步定时方式  
- 基本特征
  - 采用统一的时钟信号协调发送和接收双方
  - 时钟产生相等的时间间隔
  - 每个间隔构成一个总线周期
  - 一个总线周期可进行一次数据传送

- 优点
  - 传送速度快，具有较高的传输速率
  - 总线控制逻辑简单
- 缺点
  - 主从设备属于强制性同步
  - 不能及时进行数据通信的有效性检验
  - 可靠性较差

#### 同步串行通信
- 特点
  - 发送方时钟直接控制接收方时钟
  - 双方完全同步的逐位传输
  - 仅在数据块头尾添加开始和结束标记
  - 传输效率高但硬件复杂

### 异步定时方式  
- 基本特征
  - 无统一时钟和固定时间间隔
  - 依靠传送双方"握手"信号实现定时控制
  - 主设备提出"请求"信号
  - 从设备发出"回答"信号

- 优点
  - 总线周期长度可变
  - 能保证不同速度设备间可靠信息交换
  - 自动适应时间配合
- 缺点
  - 控制较复杂
  - 速度较慢

#### 异步定时类型
##### 不互锁方式
- 主设备不等待回答信号即可撤销请求
- 从设备自动撤销回答信号
- 双方无互锁关系

##### 半互锁方式
- 主设备需等待回答信号后撤销请求
- 从设备自动撤销回答信号
- 单向互锁关系

##### 全互锁方式
- 主设备需等待回答后撤销请求
- 从设备需等待请求撤销后撤销回答
- 双向互锁关系

![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/e30f9589c45b2a57c15931e592518bb215f20b47d5abf20d0fd0e062b8376d2f.jpg)  
图6.4请求和回答信号的互锁  

> pro：异步串行通信方式的特点（2016）  

#### 异步串行通信
- 特点
  - 收发双方时钟不严格一致
  - 每个字符都有开始位和停止位
  - 通信线空闲时为逻辑"1"
  - 数据位从最低位开始传输
  - 可选奇偶校验位
  - 最后发送停止位

### 半同步定时方式  
- 基本特征
  - 结合同步和异步定时特点
  - 信号发出时间参照系统时钟前沿
  - 接收方采用系统时钟后沿判断
  - 增设Wait响应信号线

- 优点
  - 控制方式比异步定时简单
  - 各模块同步工作，可靠性高
- 缺点
  - 系统时钟频率不能太高
  - 整体工作速度不高

### 分离式定时方式  
- 基本特征
  - 将总线事务分解为请求和应答两个子过程
  - 两个子过程都是单方向信息流
  - 每个设备都可变为主设备

#### 第一子过程
- 主设备获得总线使用权
- 发送命令和地址信息
- 从设备接收信息
- 主设备立即释放总线

#### 第二子过程
- 从设备准备数据
- 申请总线使用权
- 发送准备好的数据
- 主设备接收数据

- 优点
  - 不传送数据时释放总线
  - 可接受其他设备请求
  - 无空闲等待时间
- 缺点
  - 控制复杂
  - 开销大


### 本章小结  

#### 总线结构的优点?
- 引入总线结构主要有以下优点：
  - 简化了系统结构，便于系统设计制造
  - 便于接口设计，所有与总线连接的设备均采用类似的接口
  - 便于系统的扩充、更新与灵活配置，易于实现系统的模块化
  - 便于设备的软件设计，所有接口的软件对不同的接口地址进行操作
  - 便于故障诊断和维修，同时也能降低成本

#### 总线引入的问题及解决方案?
- 主要问题
  - 总线上的各个设备分时共享同一总线
  - 多个设备同时请求使用总线时会导致冲突
- 解决方案
  - 采用总线仲裁部件
  - 以某种方式选择一个主设备获得总线控制权
  - 只有获得总线控制权的设备才能开始数据传送
# 常见问题和易混淆知识点  

1.一个总线在某一时刻可以有多对主从设备进行通信吗？  

不可以。
总线通信的特点:
- 主从设备通信规则
  - 单一主设备控制
    - 每个总线周期内 only 1主设备控制总线
  - 通信模式
    - 一对一通信：主设备选择单个从设备进行通信
    - 一对多通信：主设备对所有设备进行广播
  - 限制原因
    - 不允许多对主从设备同时通信
    - 避免数据冲突