

# 传输层提供的<span style="color: blue;">服务  
## 端口号
- 端口号
  - **熟知**端口号: **0**～**1**023
  - **登记**端口号：**1**024～**4**9151
  - <span style="color: green;">客户</span>端 端口号：**4**9152～**6**5535
-  TCP常用熟知端口号  
   - | 应用程序 | 端口号 |
     |---------|--------|
     | **FTP** | **21** |
     | SSH | 22 |
     | TELNET | 23 |
     | **SMTP** | **25** |
     | DNS | 53 |
     | **TFTP** | **69** |
     | HTTP | **80**← | 
     | **POP3** | **110** |
     | HTTPS | 443 |

- 端口号只具有**本地**意义
  - 即端口号只标识本计算机应用层中的各个进程
  - 同一台计算机中TCP和UDP
    - 分别拥有自己的端口号
    - 互不干扰
## OSI模型
- OSI模型
  - 上三层（会话层、表示层和应用层） ← 数据处理&用户接口 [<span style="color: orange;">资源</span>子网]
  - 传输层 1
    - 向高层用户屏蔽下面通信子网的细节(如网络拓扑、路由协议等)
  - 下三层（物理层、数据链路层和网络层） ← 数据通信&交换 [<span style="color: green;">通信</span>子网]

- 各层提供的服务
  - 传输：端到端（进程到进程）
  - 网络层：主机到主机
  - 物理：两个**结点**之间透明地传输比特流

## TCP数据报+data → IP数据报
- eg：每秒产生一个60B的数据块，每个数据块被封装在一个TCP报文中 → 封装在一个 IP 数据报
  - TCP报文、IP数据报的首部长度：20B
    - IP数据报 located in传输层，用于运输
<br>
- - -
<br>

# UDP
>UDP 本质是一个protocol，数据报 是它涉及到的一个element
- UDP的可靠保障只能依靠：传输层的上层→应用层
## 数据报
- 长度：
  - 首部+数据
- 伪首部
    - 临时添加的（既不向下传送又不向上递交
  - includes 源IP&目的IP
    - **源**端口
      - 源端口号
      - 在需要对方**回信时**选用，不需要时可用全0
    - **目的**端口
      - 目的端口号
      - 这在终点**交付**报文时**必须使用**到
- <div style="display: flex;">
  <img src="https://cdn-mineru.openxlab.org.cn/model-mineru/prod/05fa857d9ae050353446295e04e96bef0c74167c8553e5cf4439dd5c06e12f8d.jpg" alt="UDP数据报" style="width: 550px; margin-right: 10px;">
  <img src="https://cdn-mineru.openxlab.org.cn/model-mineru/prod/4f25e5e7af600a926e06cfbeecdb4d247bc24f97f4e1b6d8267cb4459a094260.jpg" alt="TCP报文段" style="width: 600px;">
</div>

### 应用场景
- 远程登录 依靠一个客户端→服务器 的可靠连接
  - 必须保证数据传输的安全性
### <span style="color: green;">计算</span>：length片数&传输效率 

#### length：
- UDP首部的信息(十六进制表示)为0x F7 21 00 45 00 2C E8 27
- UDP数据报格式
  - ![](https://cdn-mineru.openxlab.org.cn/model-mineru/prod/da63d7c9b93503146918383294c5c15589fdbdc37358c5de93970ddb49063021.jpg)  
  - Q:源端口、目的端口、数据报总长度、数据部'length

解：
*1 16bit=2B
- 第1、2个字节(B)为**源**端口，即F7 21,转换成十进制数为63265
- 第3、4个字节为**目的**端口，即0045,转换成十进制数为69
- 第5、6个字节为**UDP**长度(包含首部和数据部分),即 00 2C,转换成十进制数为44
  - 数据报总长度为44B,数据部分长度为44-8=36B

- 由1)可知
  - 该UDP数据报的源端口号为63265,目的端口号为69
  - 前一个为客户端使用的端口号，后一个为熟知的TFTP协议的端口，可知该数据报是客户发给服务器的。
#### 片数（length&片段偏移）：
1.  一个UDP 数据报的数据字段长度为9192B
      - 如在数据链路层要采用以太网来传送
      - Q: 应当将其划分为IP数据报片的片数__

    解：
    - UDP 数据字段长度9192B,+ UDP首部长度8B → 9200B
    - 每个IP 数据报片的最大长度1500B - IP首部 20B → 1480B
    - $9200/1480≈7$
      - 每个IP数据报片的数据字段长度为1480B
        - 除了最后一个为1040B
      - 每个IP数据报片的偏移字段的值
        - 依次为0,185,370,555,740,925,1110
          - 1. 第一片偏移值 = 0 ÷ 8 = 0 
          - 2. 第二片偏移值 = 1480 ÷ 8 = 185 
          - 3. 第三片偏移值 = (1480 × 2) ÷ 8 = 370 
          - 4. 第四片偏移值 = (1480 × 3) ÷ 8 = 555 
          - 5. 第五片偏移值 = (1480 × 4) ÷ 8 = 740 
          - 6. 第六片偏移值 = (1480 × 5) ÷ 8 = 925 
          - 7. 第七片偏移值 = (1480 × 6) ÷ 8 = 1110
<br>
2. 一个UDP用户数据报的数据字段为 8192B
   - 假定IP数据报无选项
   - 要使用以太网来传送
   - Q: 应当将其划分为IP数据报片的片数

    解：
    - 8192B + 8B = 8200B
    - **以太网帧**的数据段的最大长度**1500B** **- 20B** = **1480**B
    - $8200/1480≈5.5$
      - 应当划分为6个IP报片
    - 片段偏移字段的值依次为0,185,370,555,740,925

#### 传输效率
- 某应用层数据大小为200B
  - 传输层使用UDP,**网际层**使用IP(采用最大首部长度),使用以太网进行传输(不考虑前导码和VLAN)
  - Q: 传输效率
*网际层=网络层
解：
- 以太网**MAC帧**首部和尾部为18B
- 网际层IP首部为60B(采用最大首部长度)
- 传输层UDP首部为8B
  - ↓
  - $200÷(200+18+60+8)=69.9\%$
## 检验和
- ![image](https://bluejedis.github.io/picx-images-hosting/image.4g4j0ss5qe.webp)
- conclusion:
  - UDP检验和非必需
    - 若不使用检验和，则将检验和字段设置为0
  - 若检验和的计算结果恰好为0,则将检验和字段置为全1（了解即可）
## UDP DG & IP DG(network-layer) | UDP&TCP
| Socket (IP: Port) | UDP | TCP |
|:-----------------:|:---:|:---:|
| **IP** | - | - |

### UDP数据报 与 IP数据报(network-layer)'区别

- IP 数据报只能找到目的主机而无法找到目的进程
- UDP提供端口功能 及复用和分用功能
### 丢失后重传
- 重传时，IP 数据报的标识字段会有另一个标识符
  - 仅当标识符相同的IP数据报片
  - 才能组装成一个IP 数据报
### UDP和TCP
#### 应用场景
- TCP
  - 实时性低,可靠性高
    - used in文件传输 email
- UDP
  - ==实时性==高,可靠性低
  - vieo/audio 传输
<br>
- - -
<br>
<span style="font-size: 45px;">  👻</span>

# TCP 
## 报文

## 连接
## 控制
- rwnd &emsp;&emsp;cwnd  &emsp;&emsp;ssthresh
- 接收窗口  拥塞窗口   慢开始门限
  - **rwnd**即**接收方** 允许**连续接收**的**能力**
## TCP与UDP
### 首部
- TCP和UDP首部均含检验和
  - TCP检验和不仅检验数据，还检验TCP首部
  - UDP检验和仅检验数据
- TCP首部独有的是 **seq** 和 **ack**
#### 伪首部
##### 伪首部协议字段
- 用于指明上层协议是TCP还是UDP
  - 17 → UDP
  - 6 → TCP
##### 首部&伪首部' 区别
核心区别：
- **伪首部**是为了计算校验和而设计的临时结构，**不参与实际传输**
  - 包含了IP层的信息(源IP和目的IP)
- **首部**是**实际传输**数据包的组成部分
  - 首部不包含~